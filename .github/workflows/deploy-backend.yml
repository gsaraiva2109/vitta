name: Deploy Backend

on:
  push:
    paths:
      - 'api/**' # Dispara apenas quando arquivos na pasta `api` s√£o alterados.

jobs:
  deploy:
    name: Trigger Backend Deploy via Webhook
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Backend Deploy
        env:
          COOLIFY_TOKEN: ${{ secrets.COOLIFY_TOKEN }}
          BACKEND_WEBHOOK_URL: ${{ secrets.COOLIFY_BACKEND_WEBHOOK_URL }}
        run: |
          echo "üöÄ Triggering Backend Deploy Webhook..."
          
          RESPONSE=$(curl -X POST -s -o response.txt -w "%{http_code}" \
            -H "Authorization: Bearer $COOLIFY_TOKEN" \
            "$BACKEND_WEBHOOK_URL" -d "{}")
          
          if [ $RESPONSE -eq 200 ]; then
            echo "‚úÖ Backend Deploy Triggered Successfully!"
          else
            echo "‚ùå Error Triggering Backend Deploy!"
            cat response.txt
            exit 1
          fi